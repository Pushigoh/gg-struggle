# NOTE: This must be run as admin!

$storeMy = "Cert:\LocalMachine\My"
$storeRoot = "Cert:\LocalMachine\Root"

New-SelfSignedCertificate `
  -KeyLength 4096 `
  -DnsName "ggst-game.guiltygear.com", "localhost" `
  -CertStoreLocation $storeMy `
  -KeyLocation "c:\tools" `
  -KeyFriendlyName "generated by gg-struggle/tools/gencert.ps1" `
  -KeyDescription "gg-struggle-key" `
  -FriendlyName "gg-struggle" `

$certs = Get-ChildItem $storeMy `
 | where{$_.Subject -eq "CN=ggst-game.guiltygear.com"}

# Install cert from the My store into Root store
Foreach ($cert in $certs) {
  $certId = $cert.Thumbprint
  Write-Host "Installed $storeRoot\$certId to $storeRoot "
  Move-Item -path $storeMy\$certId -Destination $storeRoot
}

